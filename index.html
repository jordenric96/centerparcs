<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Spidey Lou">
    <link rel="manifest" href="manifest.json">

    <title>Lou's Spidey Games</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Roboto:wght@400;900&display=swap');

        :root {
            --red: #E23636;
            --blue: #013889;
            --gold: #FFD700;
            --dark: #111;
        }

        * { box-sizing: border-box; touch-action: none; -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--blue);
            font-family: 'Roboto', sans-serif;
            margin: 0; padding: 0;
            color: white; text-align: center;
            overflow: hidden; 
            background-image: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            height: 100vh; display: flex; flex-direction: column;
        }

        /* HEADER */
        header { padding: 10px; background: rgba(0,0,0,0.2); }
        h1 {
            font-family: 'Bangers', cursive; font-size: 2rem; margin: 0;
            color: var(--red); text-shadow: 2px 2px 0 #fff; letter-spacing: 1px;
        }

        /* KALENDER GRID */
        #calendarContainer {
            flex-grow: 1; overflow-y: auto; touch-action: pan-y; 
            padding: 20px; padding-bottom: 80px;
        }

        .calendar-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px; max-width: 900px; margin: 0 auto;
        }

        .day-card {
            background: white; border: 4px solid var(--dark); border-radius: 15px;
            height: 120px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; position: relative;
            color: var(--dark); box-shadow: 0 6px 0 var(--dark);
            transition: transform 0.1s;
        }
        .day-card:active { transform: translateY(6px); box-shadow: none; }
        
        .date-number { font-family: 'Bangers'; font-size: 3rem; line-height: 1; color: var(--blue); }
        .day-text { font-weight: bold; font-size: 0.9rem; text-transform: uppercase;}
        
        /* Statussen */
        .locked { filter: grayscale(1); opacity: 0.5; background: #ccc; pointer-events: none;}
        .active-day { border-color: var(--red); animation: pulse 1.5s infinite; background: #fff; cursor: pointer;}
        .completed { background: #bbf7d0; border-color: #166534; color: #166534; opacity: 0.9; }
        .completed::after { content: "‚úÖ"; position: absolute; font-size: 3rem; opacity: 0.8; }
        .final-day { background: var(--gold); border-color: white; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        /* MODALS */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 1000;
            flex-direction: column; align-items: center; justify-content: center;
        }

        .instruction-box {
            background: #fff; color: #000; padding: 20px; border-radius: 20px;
            width: 90%; max-width: 500px; text-align: center; border: 6px solid var(--red);
        }
        .game-title { font-family: 'Bangers'; font-size: 2.2rem; color: var(--blue); margin-bottom: 10px; }
        .game-desc { font-size: 1.2rem; line-height: 1.4; margin-bottom: 20px; }

        /* GAME UI */
        #gameUI {
            width: 100%; height: 100%; display: flex; flex-direction: column;
            align-items: center; padding: 10px;
        }

        .hud-bar {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; max-width: 800px; background: rgba(0,0,0,0.6); 
            padding: 5px 20px; border-radius: 50px; margin-bottom: 10px; border: 2px solid white;
        }
        
        .score-box { font-family: 'Bangers'; font-size: 1.8rem; color: var(--gold); }
        .timer-box { font-family: 'Roboto'; font-weight: 900; font-size: 1.5rem; color: white; }

        #gameCanvas {
            flex-grow: 1; width: 100%; max-width: 800px; background: #222;
            border: 4px solid var(--red); border-radius: 15px; position: relative;
            overflow: hidden; touch-action: none;
        }

        /* Buttons */
        .btn {
            background: var(--red); color: white; border: none; padding: 15px 30px;
            font-family: 'Bangers'; font-size: 1.5rem; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px 0 #8b0000; margin: 10px;
        }
        .btn:active { transform: translateY(5px); box-shadow: none; }
        .btn-close { 
            background: #d32f2f; width: 40px; height: 40px; border-radius: 50%; 
            padding: 0; font-size: 1.2rem; line-height: 40px; border: 2px solid white;
        }

        /* --- GAME ELEMENTS --- */
        
        /* Memory Fix */
        .mem-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            grid-template-rows: repeat(3, 1fr); /* Forceer hoogte */
            gap: 10px; width: 100%; height: 100%; padding: 10px; 
        }
        .mem-card { 
            background: var(--blue); border-radius: 8px; border: 3px solid white; 
            display: flex; justify-content: center; align-items: center; font-size: 0;
            width: 100%; height: 100%; /* Vul cel */
        }
        .mem-card.flipped { background: white; font-size: 3.5rem; transform: rotateY(180deg); transition: transform 0.3s;}

        /* Maze */
        .maze-grid { display: grid; width: 100%; height: 100%; }
        .maze-cell { border: 1px solid #333; display: flex; justify-content: center; align-items: center; font-size: 1.5rem;}
        .maze-controls { 
            display: none; width: 100%; max-width: 300px; margin-top: 10px; 
            grid-template-columns: repeat(3, 1fr); gap: 10px; 
        }
        .arrow-btn { 
            background: rgba(255,255,255,0.2); border: 2px solid white; border-radius: 10px; 
            height: 60px; font-size: 30px; display: flex; justify-content: center; align-items: center;
        }
        .arrow-btn:active { background: var(--red); }

        /* Algemeen */
        .target { position: absolute; user-select: none; }
        .flying-obj { position: absolute; font-size: 3.5rem; pointer-events: none;}
        
        /* Win Screen */
        .win-time { font-size: 2.5rem; font-weight: bold; color: var(--blue); margin: 15px 0; }
        .best-time { font-size: 1.2rem; color: #555; }
        .new-record { color: var(--red); font-weight: bold; animation: pulse 0.5s infinite; }
        .confetti { position: absolute; width: 10px; height: 10px; pointer-events: none; }
        
        /* Score Reset Effect */
        .shake-screen { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

    </style>
</head>
<body>

    <header>
        <h1>LOU'S SPIDEY APP</h1>
    </header>
    
    <div id="calendarContainer">
        <div id="calendar" class="calendar-grid"></div>
        <div style="margin-top:40px;">
            <button class="btn" style="background:#555; font-size:0.8rem; padding:10px;" onclick="resetAll()">‚öôÔ∏è Reset App</button>
        </div>
    </div>

    <div id="introModal" class="modal">
        <div class="instruction-box">
            <button class="btn btn-close" style="position:absolute; right:-10px; top:-10px;" onclick="closeModal('introModal')">‚úï</button>
            <div id="introTitle" class="game-title">Titel</div>
            <div id="introText" class="game-desc">Uitleg</div>
            <button class="btn" onclick="startGame()">START!</button>
        </div>
    </div>

    <div id="gameModal" class="modal">
        <div id="gameUI">
            <div class="hud-bar">
                <div id="scoreVal" class="score-box">0 / 10</div>
                <div id="timerVal" class="timer-box">0.0s</div>
                <button class="btn btn-close" onclick="quitGame()">‚úï</button>
            </div>
            
            <div id="gameCanvas"></div>

            <div id="mazeControls" class="maze-controls">
                <div></div>
                <div class="arrow-btn" onpointerdown="handleMazeMove(0, -1)">‚¨ÜÔ∏è</div>
                <div></div>
                <div class="arrow-btn" onpointerdown="handleMazeMove(-1, 0)">‚¨ÖÔ∏è</div>
                <div class="arrow-btn" onpointerdown="handleMazeMove(0, 1)">‚¨áÔ∏è</div>
                <div class="arrow-btn" onpointerdown="handleMazeMove(1, 0)">‚û°Ô∏è</div>
            </div>
        </div>
    </div>

    <div id="winModal" class="modal">
        <div class="instruction-box" style="border-color: var(--gold);">
            <div class="game-title">üéâ GEWONNEN! üéâ</div>
            <div class="win-time" id="finalTimeDisplay">0.0s</div>
            <div class="best-time" id="bestTimeDisplay">Record: 0.0s</div>
            <button class="btn" onclick="finishDay()">MISSIE VOLTOOID</button>
        </div>
    </div>

<script>
    // --- CONFIGURATIE ---
    // ZET OP 'false' ALS JE KLAAR BENT MET TESTEN!
    const TEST_MODE = true; 
    
    const TARGET_DATE = new Date(2026, 1, 2); 
    const TOTAL_GOAL = 10;
    
    // Globals
    let activeGameIdx = 0;
    let activeDateId = null;
    let score = 0;
    let startTime = 0;
    let timerInterval = null;
    let isGameRunning = false;
    let activeMazePos = {x:0, y:0};

    // Audio Engine
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(freq, type, len) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + len);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + len);
    }
    const SFX = {
        tick: () => beep(800, 'sine', 0.05),
        bad:  () => beep(150, 'sawtooth', 0.4), // Fout geluid
        win:  () => { [500,600,700,800,1000].forEach((f,i)=>setTimeout(()=>beep(f,'square',0.2), i*100)); }
    };

    // --- INIT ---
    function init() {
        const grid = document.getElementById('calendar');
        grid.innerHTML = '';
        let loopDate = new Date(); 
        for(let i=0; i<15; i++) {
            let d = new Date(loopDate); d.setDate(d.getDate() + i);
            if(d > TARGET_DATE) break;
            createDayCard(d, grid);
        }
    }

    function createDayCard(date, container) {
        const today = new Date(); today.setHours(0,0,0,0);
        const cDate = new Date(date); cDate.setHours(0,0,0,0);
        const dateId = `lou_${date.getDate()}_${date.getMonth()}`;
        const isDone = localStorage.getItem(dateId + '_done') === 'true';
        const isFuture = cDate > today;
        const isTarget = date.getDate() === 2 && date.getMonth() === 1;

        let status = '';
        if(isDone) status = 'completed';
        else if(isFuture && !TEST_MODE) status = 'locked';
        else status = 'active-day';
        if(isTarget) status += ' final-day';

        const el = document.createElement('div');
        el.className = `day-card ${status}`;
        el.innerHTML = `<div class="day-text">${date.toLocaleDateString('nl-NL',{weekday:'short'})}</div>
                        <div class="date-number">${date.getDate()}</div>
                        <div class="day-text">${date.toLocaleDateString('nl-NL',{month:'short'})}</div>`;

        if(status.includes('active-day') || status.includes('completed') || status.includes('final-day')) {
            el.onclick = () => openIntro(date, dateId);
        }
        container.appendChild(el);
    }

    function openIntro(date, dateId) {
        if(date.getDate() === 2 && date.getMonth() === 1) {
            alert("HOERA! CENTER PARCS! üöóüí®"); SFX.win(); return;
        }
        activeDateId = dateId;
        activeGameIdx = (date.getDate() % 6) + 1;
        
        const info = [
            null,
            {t: "Pumpkin Ninja üéÉ", d: "Hak de pompoenen! Raak GEEN webben, want dan begint je score opnieuw!"},
            {t: "Zoek Venom üëÄ", d: "Het krioelt van de spinnen! Tik alleen op VENOM (de zwarte). Tik je een spin? Score 0!"},
            {t: "Web Blaster üï∏Ô∏è", d: "Schiet de boeven neer! Raak GEEN bommen!"},
            {t: "Het Doolhof üó∫Ô∏è", d: "Gebruik de pijltjes om Spidey naar de vlag te brengen."},
            {t: "Vang de Spullen ü©≥", d: "Vang zwembroeken en ballen. Vang GEEN spinnen (Score 0)!"},
            {t: "Spidey Memory üß†", d: "Zoek de paren. De klok tikt!"}
        ];

        document.getElementById('introTitle').innerText = info[activeGameIdx].t;
        document.getElementById('introText').innerText = info[activeGameIdx].d;
        document.getElementById('introModal').style.display = 'flex';
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function startGame() {
        closeModal('introModal');
        document.getElementById('gameModal').style.display = 'flex';
        document.getElementById('mazeControls').style.display = 'none';
        
        isGameRunning = true;
        score = 0;
        updateHUD();
        
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const delta = (Date.now() - startTime) / 1000;
            document.getElementById('timerVal').innerText = delta.toFixed(1) + 's';
        }, 100);

        const cvs = document.getElementById('gameCanvas');
        cvs.innerHTML = '';
        
        if(activeGameIdx === 1) initNinja(cvs);
        if(activeGameIdx === 2) initSearch(cvs);
        if(activeGameIdx === 3) initShooter(cvs);
        if(activeGameIdx === 4) initMaze(cvs);
        if(activeGameIdx === 5) initCatcher(cvs);
        if(activeGameIdx === 6) initMemory(cvs);
    }

    function quitGame() {
        isGameRunning = false;
        clearInterval(timerInterval);
        document.getElementById('gameModal').style.display = 'none';
    }

    function updateHUD() {
        let max = TOTAL_GOAL;
        if(activeGameIdx === 4) max = "Vlag";
        if(activeGameIdx === 6) max = "6 Paren";
        document.getElementById('scoreVal').innerText = `${score} / ${max}`;
    }

    function punish() {
        SFX.bad();
        score = 0;
        updateHUD();
        const ui = document.getElementById('gameUI');
        ui.classList.add('shake-screen');
        setTimeout(() => ui.classList.remove('shake-screen'), 500);
    }

    function triggerWin() {
        if(!isGameRunning) return;
        isGameRunning = false;
        clearInterval(timerInterval);
        
        const finalTime = ((Date.now() - startTime) / 1000).toFixed(1);
        const storeKey = `hs_game_${activeGameIdx}`;
        const oldBest = parseFloat(localStorage.getItem(storeKey)) || 999;
        let isRecord = false;
        
        if(parseFloat(finalTime) < oldBest) {
            localStorage.setItem(storeKey, finalTime);
            isRecord = true;
        }

        document.getElementById('gameModal').style.display = 'none';
        document.getElementById('winModal').style.display = 'flex';
        document.getElementById('finalTimeDisplay').innerText = `Tijd: ${finalTime}s`;
        
        const bestDisplay = isRecord ? "NIEUW RECORD!" : `Record: ${oldBest}s`;
        document.getElementById('bestTimeDisplay').innerText = bestDisplay;
        if(isRecord) document.getElementById('bestTimeDisplay').className = "new-record";
        
        SFX.win();
        spawnConfetti();
    }

    function finishDay() {
        localStorage.setItem(activeDateId + '_done', 'true');
        closeModal('winModal');
        init(); 
    }

    function resetAll() {
        if(confirm("Alles wissen?")) { localStorage.clear(); location.reload(); }
    }

    // --- GAME 1: NINJA (Swipe + Punish) ---
    function initNinja(canvas) {
        canvas.onpointermove = (e) => {
            if(!isGameRunning) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            document.querySelectorAll('.flying-obj').forEach(obj => {
                const oRect = obj.getBoundingClientRect();
                const ox = (oRect.left - rect.left) + oRect.width/2;
                const oy = (oRect.top - rect.top) + oRect.height/2;
                if(Math.hypot(ox - x, oy - y) < 60) {
                    obj.remove();
                    if(obj.dataset.type === 'bad') {
                        punish();
                    } else {
                        SFX.tick();
                        score++;
                        updateHUD();
                        if(score >= TOTAL_GOAL) triggerWin();
                    }
                }
            });
        };

        function spawn() {
            if(!isGameRunning) return;
            const el = document.createElement('div');
            el.className = 'flying-obj';
            const isBad = Math.random() > 0.7; // 30% kans op web
            el.innerText = isBad ? 'üï∏Ô∏è' : 'üéÉ';
            el.dataset.type = isBad ? 'bad' : 'good';
            el.style.left = '-60px';
            el.style.top = Math.random() * 80 + '%';
            canvas.appendChild(el);

            el.animate([{transform:'translateX(0)'}, {transform:`translateX(${canvas.clientWidth+100}px)`}], 
                {duration: 2500, easing:'linear'}).onfinish = () => el.remove();
            
            setTimeout(spawn, 700);
        }
        spawn();
    }

    // --- GAME 2: ZOEK VENOM (Veel spinnen + Punish) ---
    function initSearch(canvas) {
        function round() {
            if(!isGameRunning) return;
            canvas.innerHTML = '';
            
            // 40 Spinnen!
            for(let i=0; i<40; i++) {
                const d = document.createElement('div');
                d.className = 'target'; d.innerText = 'üï∑Ô∏è';
                d.style.fontSize = '30px';
                d.style.left = Math.random() * 90 + '%';
                d.style.top = Math.random() * 90 + '%';
                d.style.opacity = '0.7';
                d.onpointerdown = (e) => { e.stopPropagation(); punish(); round(); };
                canvas.appendChild(d);
            }

            const t = document.createElement('div');
            t.className = 'target'; t.innerText = 'üë∫'; // Venom/Goblin
            t.style.fontSize = '60px'; t.style.zIndex = 10;
            t.style.left = Math.random() * 85 + '%';
            t.style.top = Math.random() * 85 + '%';
            t.onpointerdown = (e) => {
                e.stopPropagation(); SFX.tick(); score++; updateHUD();
                if(score >= TOTAL_GOAL) triggerWin(); else round();
            };
            canvas.appendChild(t);
        }
        round();
    }

    // --- GAME 3: WEB BLASTER (Vervangt Auto Was) ---
    function initShooter(canvas) {
        function spawnTarget() {
            if(!isGameRunning) return;
            const t = document.createElement('div');
            const isBad = Math.random() > 0.7;
            t.innerText = isBad ? 'üí£' : 'ü¶π‚Äç‚ôÇÔ∏è';
            t.className = 'target'; t.style.fontSize = '70px';
            t.style.left = Math.random() * 80 + '%';
            t.style.top = Math.random() * 80 + '%';
            
            // Verdwijnt snel
            let life = setTimeout(() => { if(t.parentNode) t.remove(); spawnTarget(); }, 900);

            t.onpointerdown = (e) => {
                e.preventDefault(); clearTimeout(life);
                t.remove();
                if(isBad) {
                    punish();
                } else {
                    SFX.tick(); score++; updateHUD();
                    if(score >= TOTAL_GOAL) triggerWin();
                }
                spawnTarget();
            };
            canvas.appendChild(t);
        }
        spawnTarget();
    }

    // --- GAME 4: DOOLHOF (Nieuw) ---
    function initMaze(canvas) {
        document.getElementById('mazeControls').style.display = 'grid';
        canvas.innerHTML = '<div class="maze-grid" id="mazeGrid"></div>';
        const gridEl = document.getElementById('mazeGrid');
        
        // 8x8 Grid. 0=pad, 1=muur, 2=start, 3=finish
        gridEl.style.gridTemplateColumns = 'repeat(8, 1fr)';
        const map = [
            [2,0,0,1,0,0,0,0],
            [1,1,0,1,0,1,1,1],
            [0,0,0,0,0,0,0,0],
            [0,1,1,1,1,1,1,0],
            [0,0,0,0,0,0,1,0],
            [1,1,1,1,0,1,1,0],
            [0,0,0,1,0,0,0,0],
            [0,1,0,0,0,1,1,3]
        ];
        
        for(let y=0; y<8; y++) {
            for(let x=0; x<8; x++) {
                const c = document.createElement('div');
                c.className = 'maze-cell';
                c.id = `mc_${x}_${y}`;
                if(map[y][x]===1) c.style.background = '#444';
                if(map[y][x]===3) c.innerText = 'üèÅ';
                gridEl.appendChild(c);
                if(map[y][x]===2) { activeMazePos={x,y}; renderMazePlayer(); }
            }
        }
        window.mazeMap = map;
    }

    window.handleMazeMove = (dx, dy) => {
        if(!isGameRunning || activeGameIdx !== 4) return;
        const nx = activeMazePos.x + dx; const ny = activeMazePos.y + dy;
        if(nx<0||nx>7||ny<0||ny>7) return;
        if(window.mazeMap[ny][nx]===1) { SFX.bad(); return; } // Muur
        
        // Clear old
        document.getElementById(`mc_${activeMazePos.x}_${activeMazePos.y}`).innerText = '';
        activeMazePos = {x:nx, y:ny};
        renderMazePlayer();
        
        if(window.mazeMap[ny][nx]===3) triggerWin();
    };

    function renderMazePlayer() {
        const c = document.getElementById(`mc_${activeMazePos.x}_${activeMazePos.y}`);
        c.innerText = 'üï∑Ô∏è';
    }

    // --- GAME 5: VANGEN (Meer vijanden) ---
    function initCatcher(canvas) {
        const basket = document.createElement('div');
        basket.innerText = 'üï∏Ô∏è'; basket.className = 'target'; 
        basket.style.fontSize = '80px'; basket.style.bottom = '10px';
        canvas.appendChild(basket);

        canvas.onpointermove = (e) => {
            const r = canvas.getBoundingClientRect();
            let x = e.clientX - r.left;
            if(x<0) x=0; if(x>r.width) x=r.width;
            basket.style.left = (x-40)+'px';
        }

        function drop() {
            if(!isGameRunning) return;
            const item = document.createElement('div');
            // 40% kans op slechterik
            const isBad = Math.random() > 0.6;
            item.innerText = isBad ? 'üï∑Ô∏è' : 'ü©≥';
            item.className = 'target'; item.style.fontSize = '50px';
            item.style.top = '-50px'; item.style.left = Math.random() * 90 + '%';
            canvas.appendChild(item);

            let pos = -50;
            const fall = setInterval(() => {
                if(!isGameRunning) { clearInterval(fall); return; }
                pos += 4; item.style.top = pos + 'px';
                
                if(pos > canvas.clientHeight - 80) {
                    const bx = parseFloat(basket.style.left);
                    const ix = parseFloat(item.style.left)/100 * canvas.clientWidth;
                    if(Math.abs(bx-ix) < 60) {
                        item.remove(); clearInterval(fall);
                        if(isBad) punish();
                        else {
                            SFX.tick(); score++; updateHUD();
                            if(score >= TOTAL_GOAL) triggerWin();
                        }
                    }
                }
                if(pos > canvas.clientHeight) { item.remove(); clearInterval(fall); }
            }, 20);
            setTimeout(drop, 600); // Sneller
        }
        drop();
    }

    // --- GAME 6: MEMORY (Fix + 6 paren) ---
    function initMemory(canvas) {
        canvas.innerHTML = '<div class="mem-grid" id="memGrid"></div>';
        const grid = document.getElementById('memGrid');
        const icons = ['üï∑Ô∏è','üï∏Ô∏è','üë∫','ü¶∏','üèôÔ∏è','‚ö°'];
        let deck = [...icons, ...icons].sort(()=>Math.random()-0.5);
        let first=null, lock=false;

        deck.forEach(i => {
            const c = document.createElement('div');
            c.className = 'mem-card';
            c.dataset.v = i;
            c.onclick = () => {
                if(lock || c===first || c.classList.contains('matched')) return;
                c.classList.add('flipped'); c.innerText = i;
                if(!first) first = c;
                else {
                    lock = true;
                    if(first.dataset.v === i) {
                        SFX.tick();
                        first.classList.add('matched'); c.classList.add('matched');
                        score++; updateHUD();
                        first=null; lock=false;
                        if(score===6) triggerWin();
                    } else {
                        setTimeout(()=>{
                            first.classList.remove('flipped'); c.classList.remove('flipped');
                            first.innerText=''; c.innerText='';
                            first=null; lock=false;
                        }, 800);
                    }
                }
            };
            grid.appendChild(c);
        });
    }

    // --- UTILS ---
    function spawnConfetti() {
        const c = ['#f00','#00f','#ff0'];
        for(let i=0;i<60;i++){
            const p = document.createElement('div');
            p.className='confetti'; p.style.background=c[Math.floor(Math.random()*3)];
            p.style.left='50%'; p.style.top='50%';
            document.body.appendChild(p);
            const x = (Math.random()-0.5)*window.innerWidth;
            const y = (Math.random()-0.5)*window.innerHeight;
            p.animate([{transform:'translate(0,0)'},{transform:`translate(${x}px,${y}px)`,opacity:0}],{duration:1500}).onfinish=()=>p.remove();
        }
    }

    init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Spidey Lou">
    <link rel="manifest" href="manifest.json">

    <title>Lou's Center Parcs Games</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Roboto:wght@400;900&display=swap');

        :root {
            --red: #E23636;
            --blue: #013889;
            --gold: #FFD700;
            --dark: #111;
        }

        * { box-sizing: border-box; touch-action: none; -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--blue);
            font-family: 'Roboto', sans-serif;
            margin: 0; padding: 10px;
            color: white; text-align: center;
            overflow: hidden; /* Geen scrollbalken in de app */
            background-image: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            height: 100vh; display: flex; flex-direction: column;
        }

        /* HEADER */
        h1 {
            font-family: 'Bangers', cursive; font-size: 2.5rem; margin: 5px 0;
            color: var(--red); text-shadow: 2px 2px 0 #fff; letter-spacing: 2px;
        }
        .subtitle { font-size: 1rem; margin-bottom: 10px; color: #ccc; }

        /* KALENDER GRID */
        #calendarContainer {
            flex-grow: 1; overflow-y: auto; touch-action: pan-y; /* Hier wel scrollen */
            padding-bottom: 50px;
        }

        .calendar-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 15px; max-width: 900px; margin: 0 auto; padding: 10px;
        }

        .day-card {
            background: white; border: 4px solid var(--dark); border-radius: 15px;
            height: 110px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; position: relative;
            color: var(--dark); box-shadow: 0 5px 0 var(--dark);
            transition: transform 0.1s;
        }
        .day-card:active { transform: translateY(5px); box-shadow: none; }
        
        .date-number { font-family: 'Bangers'; font-size: 2.8rem; line-height: 1; color: var(--blue); }
        .day-text { font-weight: bold; font-size: 0.9rem; text-transform: uppercase;}
        
        /* Statussen */
        .locked { filter: grayscale(1); opacity: 0.6; background: #ddd; pointer-events: none;}
        .active-day { border-color: var(--red); animation: pulse 1.5s infinite; background: #fff; cursor: pointer;}
        .completed { background: #bbf7d0; border-color: #166534; color: #166534; opacity: 0.9; }
        .completed::after { content: "‚úÖ"; position: absolute; font-size: 3rem; opacity: 0.8; }
        .final-day { background: var(--gold); border-color: white; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        /* POPUPS & MODALS */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 1000;
            flex-direction: column; align-items: center; justify-content: center;
        }

        .instruction-box {
            background: #fff; color: #000; padding: 25px; border-radius: 20px;
            width: 90%; max-width: 500px; text-align: center; border: 6px solid var(--red);
            position: relative;
        }

        .game-title { font-family: 'Bangers'; font-size: 2rem; color: var(--blue); margin-bottom: 10px; }
        .game-desc { font-size: 1.2rem; line-height: 1.5; margin-bottom: 20px; }

        /* GAME UI */
        #gameUI {
            width: 100%; height: 100%; display: flex; flex-direction: column;
            align-items: center; justify-content: flex-start; padding: 10px;
        }

        .hud-bar {
            display: flex; justify-content: space-between; width: 100%; max-width: 800px;
            background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 50px;
            margin-bottom: 10px; border: 2px solid white;
        }
        
        .score-box { font-family: 'Bangers'; font-size: 1.8rem; color: var(--gold); }
        .timer-box { font-family: 'Roboto'; font-weight: 900; font-size: 1.5rem; color: white; }

        #gameCanvas {
            flex-grow: 1; width: 100%; max-width: 800px; background: #222;
            border: 4px solid var(--red); border-radius: 15px; position: relative;
            overflow: hidden; touch-action: none;
        }

        /* Controls & Buttons */
        .btn {
            background: var(--red); color: white; border: none; padding: 15px 40px;
            font-family: 'Bangers'; font-size: 1.8rem; border-radius: 50px;
            cursor: pointer; box-shadow: 0 6px 0 #8b0000; display: inline-block; margin: 10px;
        }
        .btn:active { transform: translateY(6px); box-shadow: none; }
        .btn-close { position: absolute; top: 10px; right: 10px; width: 40px; height: 40px; border-radius: 50%; padding:0; font-size: 1.5rem; line-height: 40px;}

        /* WIN SCREEN */
        .win-time { font-size: 2rem; font-weight: bold; color: var(--blue); margin: 10px 0; }
        .best-time { font-size: 1.2rem; color: #555; }
        .new-record { color: var(--red); font-weight: bold; animation: pulse 0.5s infinite; }

        /* --- GAME ELEMENTS (CSS based) --- */
        .target { position: absolute; user-select: none; }
        .flying-obj { position: absolute; font-size: 3rem; transition: transform 0.1s; pointer-events: none;}
        .slice-trail { position: absolute; height: 4px; background: white; pointer-events: none; border-radius: 2px; }
        
        /* Runner */
        .runner-player { 
            position: absolute; bottom: 20px; left: 50px; font-size: 3.5rem; 
            transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .runner-obstacle { position: absolute; bottom: 20px; font-size: 3rem; }

        /* Car Wash */
        .dirty-spot { 
            position: absolute; width: 50px; height: 50px; background: #5d4037; 
            border-radius: 50%; opacity: 0.9; cursor: crosshair;
        }
        
        /* Catch */
        .basket { position: absolute; bottom: 10px; font-size: 4rem; transition: left 0.05s; }
        .falling-item { position: absolute; font-size: 3rem; }

        /* Memory */
        .mem-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; height: 100%; padding: 20px; align-content: center;}
        .mem-card { background: var(--blue); border-radius: 8px; border: 2px solid white; display: flex; justify-content: center; align-items: center; font-size: 0;}
        .mem-card.flipped { background: white; font-size: 3rem; transform: rotateY(180deg); transition: transform 0.3s;}

        .confetti { position: absolute; width: 10px; height: 10px; pointer-events: none; }
    </style>
</head>
<body>

    <h1>LOU & SPIDEY</h1>
    <div class="subtitle">Aftellen naar Center Parcs!</div>
    
    <div id="calendarContainer">
        <div id="calendar" class="calendar-grid"></div>
        <div style="margin-top:30px;">
            <button class="btn" style="background:#555; font-size:1rem; padding:10px 20px;" onclick="resetAll()">‚öôÔ∏è Reset App</button>
        </div>
    </div>

    <div id="introModal" class="modal">
        <div class="instruction-box">
            <button class="btn btn-close" onclick="closeModal('introModal')">‚úï</button>
            <div id="introTitle" class="game-title">Spel Titel</div>
            <div id="introText" class="game-desc">Uitleg...</div>
            <button class="btn" onclick="startGame()">START DE TIJD!</button>
        </div>
    </div>

    <div id="gameModal" class="modal">
        <div id="gameUI">
            <div class="hud-bar">
                <div id="scoreVal" class="score-box">0 / 10</div>
                <div id="timerVal" class="timer-box">0.0s</div>
                <button class="btn btn-close" style="position:static; margin:0;" onclick="quitGame()">‚úï</button>
            </div>
            <div id="gameCanvas">
                </div>
            <div id="gameControls" style="height: 80px; width:100%; display:none; justify-content:center;">
                <button id="actionBtn" class="btn" style="width:100%; height:100%; margin:0;">SPRING!</button>
            </div>
        </div>
    </div>

    <div id="winModal" class="modal">
        <div class="instruction-box" style="border-color: var(--gold);">
            <div class="game-title">üéâ GEWONNEN! üéâ</div>
            <div class="game-desc">Je hebt het gehaald!</div>
            
            <div class="win-time" id="finalTimeDisplay">12.5s</div>
            <div class="best-time" id="bestTimeDisplay">Record: 14.2s</div>
            
            <button class="btn" onclick="finishDay()">MISSIE VOLTOOID</button>
        </div>
    </div>

<script>
    // --- CONFIGURATIE ---
    // ZET DIT OP 'false' ALS DE DAGEN ECHT GEBLOKKEERD MOETEN ZIJN
    const TEST_MODE = true; 
    
    const TARGET_DATE = new Date(2026, 1, 2); // 2 Feb
    const TOTAL_GOAL = 10; // Alles gaat tot 10
    
    // Globals
    let activeGameIdx = 0;
    let activeDateId = null;
    let score = 0;
    let startTime = 0;
    let timerInterval = null;
    let gameLoopRef = null;
    let isGameRunning = false;
    let touchX = 0; // Voor swipen/draggen

    // Audio
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(freq = 600, type = 'sine', len = 0.1) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + len);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + len);
    }
    const SFX = {
        tick: () => beep(800, 'sine', 0.05),
        hit: () => beep(400, 'square', 0.1),
        jump: () => beep(300, 'sawtooth', 0.2),
        win: () => { 
            [500,600,700,800,1000].forEach((f,i)=>setTimeout(()=>beep(f,'square',0.2), i*100)); 
        }
    };

    // --- INITIALISATIE ---
    function init() {
        renderCalendar();
    }

    function renderCalendar() {
        const grid = document.getElementById('calendar');
        grid.innerHTML = '';
        
        let loopDate = new Date(); // Begin vandaag
        // Simpelheidshalve renderen we 12 dagen (of tot target)
        for(let i=0; i<12; i++) {
            let d = new Date(loopDate);
            d.setDate(d.getDate() + i);
            if(d > TARGET_DATE) break;
            
            createDayCard(d, grid);
        }
    }

    function createDayCard(date, container) {
        const today = new Date(); today.setHours(0,0,0,0);
        const cardDate = new Date(date); cardDate.setHours(0,0,0,0);
        
        const dateId = `lou_${date.getDate()}_${date.getMonth()}`;
        const isDone = localStorage.getItem(dateId + '_done') === 'true';
        const isFuture = cardDate > today;
        const isTarget = date.getDate() === 2 && date.getMonth() === 1;

        let status = '';
        if(isDone) status = 'completed';
        else if(isFuture && !TEST_MODE) status = 'locked';
        else status = 'active-day';

        if(isTarget) status += ' final-day';

        const el = document.createElement('div');
        el.className = `day-card ${status}`;
        el.innerHTML = `
            <div class="day-text">${date.toLocaleDateString('nl-NL', {weekday:'short'})}</div>
            <div class="date-number">${date.getDate()}</div>
            <div class="day-text">${date.toLocaleDateString('nl-NL', {month:'short'})}</div>
        `;

        if(status.includes('active-day') || status.includes('completed') || status.includes('final-day')) {
            el.onclick = () => openIntro(date, dateId);
        }
        container.appendChild(el);
    }

    // --- MENU FLOW ---
    function openIntro(date, dateId) {
        if(date.getDate() === 2 && date.getMonth() === 1) {
            alert("HOERA! VANDAAG GAAN WE! üöóüí®");
            SFX.win();
            return;
        }

        activeDateId = dateId;
        // Game index 1-6 op basis van dag
        activeGameIdx = (date.getDate() % 6) + 1;
        
        const titles = [
            "", 
            "Pumpkin Ninja üéÉ", 
            "Zoek Venom üëÄ", 
            "Center Parcs Car Wash üöó", 
            "Spidey Run üèÉ", 
            "Vang de Spullen ü©≥", 
            "Spidey Memory üß†"
        ];
        
        const descs = [
            "",
            "Veeg over het scherm om de pompoenen door midden te hakken! Raak er 10.",
            "Er verschijnen 10 keer plaatjes. Tik zo snel mogelijk op Venom (de zwarte)!",
            "De auto is vies! Wrijf met je vinger over de modder om hem schoon te maken.",
            "Ren door het bos! Tik op het scherm om over de obstakels te springen.",
            "Vang 10 vakantiespullen (zwembroek, bal) met Spidey. Ontwijk de spinnen!",
            "Zoek de 6 paren bij elkaar. Hoe snel ben jij?"
        ];

        document.getElementById('introTitle').innerText = titles[activeGameIdx];
        document.getElementById('introText').innerText = descs[activeGameIdx];
        document.getElementById('introModal').style.display = 'flex';
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function startGame() {
        closeModal('introModal');
        document.getElementById('gameModal').style.display = 'flex';
        document.getElementById('gameControls').style.display = 'none'; // Standaard uit
        
        isGameRunning = true;
        score = 0;
        updateHUD();
        
        // Timer Reset
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const delta = (Date.now() - startTime) / 1000;
            document.getElementById('timerVal').innerText = delta.toFixed(1) + 's';
        }, 100);

        // Start Specifieke Game
        const canvas = document.getElementById('gameCanvas');
        canvas.innerHTML = ''; // Clear
        
        if(activeGameIdx === 1) initNinja(canvas);
        if(activeGameIdx === 2) initSearch(canvas);
        if(activeGameIdx === 3) initCarWash(canvas);
        if(activeGameIdx === 4) initRunner(canvas);
        if(activeGameIdx === 5) initCatcher(canvas);
        if(activeGameIdx === 6) initMemory(canvas);
    }

    function quitGame() {
        isGameRunning = false;
        clearInterval(timerInterval);
        cancelAnimationFrame(gameLoopRef);
        document.getElementById('gameModal').style.display = 'none';
    }

    function updateHUD() {
        document.getElementById('scoreVal').innerText = `${score} / ${TOTAL_GOAL}`;
        if(activeGameIdx === 6) document.getElementById('scoreVal').innerText = `${score} / 6 Paren`;
    }

    function triggerWin() {
        if(!isGameRunning) return;
        isGameRunning = false;
        clearInterval(timerInterval);
        cancelAnimationFrame(gameLoopRef);
        
        const finalTime = ((Date.now() - startTime) / 1000).toFixed(1);
        
        // Highscore Logic
        const storeKey = `highscore_game_${activeGameIdx}`;
        const oldBest = parseFloat(localStorage.getItem(storeKey)) || 999;
        let isRecord = false;
        
        if(parseFloat(finalTime) < oldBest) {
            localStorage.setItem(storeKey, finalTime);
            isRecord = true;
        }

        // Show Win Modal
        document.getElementById('gameModal').style.display = 'none';
        document.getElementById('winModal').style.display = 'flex';
        document.getElementById('finalTimeDisplay').innerText = `Jouw tijd: ${finalTime}s`;
        
        const bestDisplay = isRecord ? "NIEUW RECORD!" : `Record: ${oldBest}s`;
        document.getElementById('bestTimeDisplay').innerText = bestDisplay;
        if(isRecord) document.getElementById('bestTimeDisplay').className = "new-record";
        
        SFX.win();
        spawnConfetti();
    }

    function finishDay() {
        localStorage.setItem(activeDateId + '_done', 'true');
        closeModal('winModal');
        init(); // Refresh kalender
    }

    function resetAll() {
        if(confirm("Alles wissen?")) {
            localStorage.clear();
            location.reload();
        }
    }

    // ---------------- DE 6 GAMES ----------------

    // 1. NINJA (Swipe events)
    function initNinja(canvas) {
        let spawnTimer;
        
        // Track mouse/touch trail
        canvas.onpointermove = (e) => {
            if(!isGameRunning) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Check collisions with flying objects
            document.querySelectorAll('.flying-obj').forEach(obj => {
                const oRect = obj.getBoundingClientRect();
                const cRect = canvas.getBoundingClientRect(); // Relatief rekenen
                
                // Simpele afstand check
                const ox = (oRect.left - cRect.left) + oRect.width/2;
                const oy = (oRect.top - cRect.top) + oRect.height/2;
                
                const dist = Math.hypot(ox - x, oy - y);
                if(dist < 50) {
                    obj.remove();
                    SFX.hit();
                    score++;
                    updateHUD();
                    if(score >= TOTAL_GOAL) triggerWin();
                }
            });
        };

        function spawn() {
            if(!isGameRunning) return;
            const el = document.createElement('div');
            el.className = 'flying-obj';
            el.innerText = Math.random() > 0.5 ? 'üéÉ' : 'üï∏Ô∏è';
            el.style.left = '-50px';
            el.style.top = Math.random() * 80 + '%';
            canvas.appendChild(el);

            // Animate via Web Animations API (gladder)
            const anim = el.animate([
                { transform: 'translateX(0) rotate(0deg)' },
                { transform: `translateX(${canvas.clientWidth + 100}px) rotate(360deg)` }
            ], {
                duration: 2000 + Math.random() * 1000,
                easing: 'linear'
            });

            anim.onfinish = () => { if(el.parentNode) el.remove(); };
            
            spawnTimer = setTimeout(spawn, 800);
        }
        spawn();
    }

    // 2. ZOEK VENOM (Tap Target)
    function initSearch(canvas) {
        function nextRound() {
            if(!isGameRunning) return;
            canvas.innerHTML = '';
            
            // Maak afleiding
            for(let i=0; i<15; i++) {
                const dummy = document.createElement('div');
                dummy.className = 'target';
                dummy.innerText = 'üï∑Ô∏è';
                dummy.style.fontSize = '40px';
                dummy.style.left = Math.random() * 90 + '%';
                dummy.style.top = Math.random() * 90 + '%';
                canvas.appendChild(dummy);
            }

            // De Target
            const target = document.createElement('div');
            target.className = 'target';
            target.innerText = 'ü¶∏‚Äç‚ôÇÔ∏è'; // Of Venom, wat je wil
            target.style.fontSize = '50px';
            target.style.left = Math.random() * 85 + '%';
            target.style.top = Math.random() * 85 + '%';
            target.style.filter = 'drop-shadow(0 0 5px white)';
            
            target.onpointerdown = (e) => {
                e.stopPropagation();
                SFX.tick();
                score++;
                updateHUD();
                if(score >= TOTAL_GOAL) triggerWin();
                else nextRound();
            };
            canvas.appendChild(target);
        }
        nextRound();
    }

    // 3. CAR WASH (Mud wiping)
    function initCarWash(canvas) {
        // Auto background
        const car = document.createElement('div');
        car.innerText = 'üöó';
        car.style.cssText = "font-size: 150px; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);";
        canvas.appendChild(car);

        // Mud Blobs
        const blobs = [];
        for(let i=0; i<30; i++) { // Meer blobs voor "100%" gevoel
            const blob = document.createElement('div');
            blob.className = 'dirty-spot';
            blob.style.left = (20 + Math.random() * 60) + '%'; // Centraal
            blob.style.top = (20 + Math.random() * 60) + '%';
            
            blob.onpointerover = () => {
                if(blob.style.opacity > 0) {
                    blob.style.opacity = 0;
                    blob.style.pointerEvents = 'none';
                    SFX.tick();
                    checkClean();
                }
            };
            canvas.appendChild(blob);
            blobs.push(blob);
        }

        // Touch support for swiping over elements
        canvas.onpointermove = (e) => {
            const el = document.elementFromPoint(e.clientX, e.clientY);
            if(el && el.classList.contains('dirty-spot')) {
                 el.onpointerover();
            }
        };

        function checkClean() {
            const remaining = blobs.filter(b => b.style.opacity != 0).length;
            const cleaned = 30 - remaining;
            // Map 30 blobs to score 10
            const newScore = Math.floor((cleaned / 30) * 10);
            if(newScore > score) {
                score = newScore;
                updateHUD();
            }
            if(remaining === 0) triggerWin();
        }
    }

    // 4. RUNNER (Jump)
    function initRunner(canvas) {
        document.getElementById('gameControls').style.display = 'flex';
        
        const player = document.createElement('div');
        player.className = 'runner-player';
        player.innerText = 'üï∑Ô∏è';
        canvas.appendChild(player);

        let isJumping = false;
        
        // Jump Action
        const jump = () => {
            if(isJumping) return;
            isJumping = true;
            SFX.jump();
            player.style.bottom = '150px';
            setTimeout(() => {
                player.style.bottom = '20px';
                setTimeout(() => isJumping = false, 300);
            }, 500);
        };

        document.getElementById('actionBtn').onclick = jump;
        canvas.onpointerdown = jump;

        function spawnObstacle() {
            if(!isGameRunning) return;
            const obs = document.createElement('div');
            obs.className = 'runner-obstacle';
            obs.innerText = 'üå≤';
            obs.style.left = '100%';
            canvas.appendChild(obs);

            // Move logic manual for collision detection
            let pos = 100;
            const moveInt = setInterval(() => {
                if(!isGameRunning) { clearInterval(moveInt); return; }
                pos -= 1.5; // Speed
                obs.style.left = pos + '%';

                // Collision
                if(pos < 15 && pos > 5) { // In zone
                     if(!isJumping) {
                         // Hit! Reset score of straf?
                         obs.innerText = 'üí•';
                         SFX.hit();
                     } else if (!obs.passed) {
                         obs.passed = true;
                         score++;
                         updateHUD();
                         SFX.tick();
                         if(score >= TOTAL_GOAL) triggerWin();
                     }
                }

                if(pos < -10) {
                    obs.remove();
                    clearInterval(moveInt);
                }
            }, 20);

            setTimeout(spawnObstacle, 1500 + Math.random() * 1000);
        }
        spawnObstacle();
    }

    // 5. CATCHER (Drag)
    function initCatcher(canvas) {
        const basket = document.createElement('div');
        basket.className = 'basket';
        basket.innerText = 'üï∏Ô∏è'; // Mandje is een web
        basket.style.left = '50%';
        canvas.appendChild(basket);

        // Move logic
        canvas.onpointermove = (e) => {
            const rect = canvas.getBoundingClientRect();
            let x = e.clientX - rect.left;
            // Clamp
            if(x < 0) x = 0;
            if(x > rect.width) x = rect.width;
            basket.style.left = (x - 20) + 'px'; // Center
        };

        function drop() {
            if(!isGameRunning) return;
            const item = document.createElement('div');
            item.className = 'falling-item';
            const isGood = Math.random() > 0.3;
            item.innerText = isGood ? 'ü©≥' : 'üï∑Ô∏è'; // Zwembroek vs Spin
            item.style.left = Math.random() * 90 + '%';
            item.style.top = '-50px';
            canvas.appendChild(item);

            let pos = -50;
            const fallInt = setInterval(() => {
                if(!isGameRunning) { clearInterval(fallInt); return; }
                pos += 3;
                item.style.top = pos + 'px';
                
                // Collision
                const bRect = basket.getBoundingClientRect();
                const iRect = item.getBoundingClientRect();
                
                // Simple overlap
                if(pos > canvas.clientHeight - 80 && pos < canvas.clientHeight - 20) {
                     const bX = parseFloat(basket.style.left);
                     const iX = parseFloat(item.style.left) / 100 * canvas.clientWidth;
                     
                     if(Math.abs(bX - iX) < 60) {
                         // Catch
                         item.remove();
                         clearInterval(fallInt);
                         if(isGood) {
                             score++;
                             SFX.tick();
                             updateHUD();
                             if(score >= TOTAL_GOAL) triggerWin();
                         } else {
                             SFX.hit();
                             score = Math.max(0, score - 1); // Straf
                             updateHUD();
                         }
                     }
                }

                if(pos > canvas.clientHeight) {
                    item.remove();
                    clearInterval(fallInt);
                }
            }, 20);

            setTimeout(drop, 1000);
        }
        drop();
    }

    // 6. MEMORY (6 paren)
    function initMemory(canvas) {
        const grid = document.createElement('div');
        grid.className = 'mem-grid';
        canvas.appendChild(grid);

        const icons = ['üï∑Ô∏è','üï∏Ô∏è','üë∫','ü¶∏','üèôÔ∏è','‚ö°'];
        let deck = [...icons, ...icons].sort(()=>Math.random()-0.5);
        let first = null; let lock = false; let matches = 0;

        deck.forEach(icon => {
            const card = document.createElement('div');
            card.className = 'mem-card';
            card.dataset.val = icon;
            card.onclick = () => {
                if(lock || card === first || card.classList.contains('matched')) return;
                SFX.jump();
                card.classList.add('flipped');
                card.innerText = icon;

                if(!first) { first = card; }
                else {
                    lock = true;
                    if(first.dataset.val === card.dataset.val) {
                        setTimeout(() => {
                            SFX.tick();
                            first.classList.add('matched'); card.classList.add('matched');
                            matches++;
                            score = matches; // Score = matches here
                            updateHUD();
                            first = null; lock = false;
                            if(matches === 6) triggerWin();
                        }, 500);
                    } else {
                        setTimeout(() => {
                            first.classList.remove('flipped'); card.classList.remove('flipped');
                            first.innerText = ''; card.innerText = '';
                            first = null; lock = false;
                        }, 1000);
                    }
                }
            };
            grid.appendChild(card);
        });
    }

    // --- UTILS ---
    function spawnConfetti() {
        const colors = ['#f00', '#00f', '#ff0', '#fff'];
        for(let i=0; i<50; i++) {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.style.background = colors[Math.floor(Math.random()*colors.length)];
            c.style.left = '50%'; c.style.top = '50%';
            document.body.appendChild(c);
            
            const destX = (Math.random() - 0.5) * window.innerWidth;
            const destY = (Math.random() - 0.5) * window.innerHeight;
            
            c.animate([
                { transform: 'translate(0,0)' },
                { transform: `translate(${destX}px, ${destY}px)`, opacity: 0 }
            ], { duration: 1500, easing: 'ease-out' }).onfinish = () => c.remove();
        }
    }

    // Boot
    init();

</script>
</body>
</html>
